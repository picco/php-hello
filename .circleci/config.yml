version: 2.1
jobs:
  build:
    docker:
      - image: google/cloud-sdk
    steps:
      - run: |
          gcloud version
          echo $GCLOUD_SERVICE_KEY | gcloud auth activate-service-account --key-file=-
          gcloud --quiet config set project ${GOOGLE_PROJECT_ID}
          gcloud --quiet config set compute/zone ${GOOGLE_COMPUTE_ZONE}    
          gsutil
      - checkout
      - run: |
          echo "great success!"
      - run: |      
          ssh-keyscan console.fenomen.ee >> ~/.ssh/known_hosts
          ssh dev@console.fenomen.ee 'mkdir -p /mnt/dev/www/deployments/${CIRCLE_PROJECT_REPONAME}/${CIRCLE_BRANCH}/build-${CIRLE_BUILD_NUM}-${CIRCLE_SHA1}/'
          scp -r ./* dev@console.fenomen.ee:/mnt/dev/www/deployments/${CIRCLE_PROJECT_REPONAME}/${CIRCLE_BRANCH}/build-${CIRLE_BUILD_NUM}-${CIRCLE_SHA1}/
